# è¯­è¨€å•ä¸€çœŸæº - æµ‹è¯•æŒ‡å—

## ğŸ§ª æµ‹è¯•å‰å‡†å¤‡

### 1. åˆ é™¤ç°æœ‰çš„ users.phpï¼ˆé‡æ–°åˆå§‹åŒ–ï¼‰

```bash
cd /www/wwwroot/maigewan
rm -f bl-kernel/_maigewan/authz/users.php
```

### 2. è®¿é—®åˆå§‹åŒ–é¡µé¢

```
http://your-domain/admin/system-init
```

---

## âœ… æµ‹è¯•æ¸…å•

### æµ‹è¯•1ï¼šè¯­è¨€åˆ—è¡¨åŠ¨æ€åŠ è½½

**æ­¥éª¤**ï¼š
1. è®¿é—®åˆå§‹åŒ–é¡µé¢
2. ç‚¹å‡»å³ä¸Šè§’çš„è¯­è¨€åˆ‡æ¢æŒ‰é’®ï¼ˆåœ°çƒå›¾æ ‡ï¼‰

**é¢„æœŸç»“æœ**ï¼š
- âœ… ä¸‹æ‹‰èœå•æ˜¾ç¤º "ä¸­æ–‡ç®€ä½“" å’Œ "English"
- âœ… åˆ—è¡¨æ˜¯ä» `bl-languages/` ç›®å½•åŠ¨æ€ç”Ÿæˆçš„

**éªŒè¯æ–¹å¼**ï¼š
```bash
# æŸ¥çœ‹ bl-languages ç›®å½•
ls -la bl-languages/*.json

# åº”è¯¥çœ‹åˆ°ï¼š
# bl-languages/en.json
# bl-languages/zh_CN.json
```

---

### æµ‹è¯•2ï¼šé€‰æ‹©è‹±æ–‡å¹¶åˆå§‹åŒ–

**æ­¥éª¤**ï¼š
1. ç‚¹å‡»è¯­è¨€åˆ‡æ¢æŒ‰é’®
2. é€‰æ‹© "English"
3. å¡«å†™ç®¡ç†å‘˜ä¿¡æ¯ï¼š
   - Username: `admin`
   - Password: `Admin123!`
   - Confirm Password: `Admin123!`
4. ç‚¹å‡» "Initialize System"

**é¢„æœŸç»“æœ**ï¼š
- âœ… è¡¨å•æç¤ºã€æŒ‰é’®ç­‰ç•Œé¢æ˜¾ç¤ºè‹±æ–‡
- âœ… æˆåŠŸåˆ›å»º `users.php` æ–‡ä»¶
- âœ… é‡å®šå‘åˆ°ç™»å½•é¡µé¢
- âœ… ç™»å½•é¡µé¢æ˜¾ç¤ºè‹±æ–‡

**éªŒè¯æ–¹å¼**ï¼š
```bash
# æŸ¥çœ‹ users.php å†…å®¹
cat bl-kernel/_maigewan/authz/users.php
```

**åº”è¯¥çœ‹åˆ°**ï¼š
```json
{
    "language": "en",   â† è¿™é‡Œåº”è¯¥æ˜¯ "en"ï¼Œä¸æ˜¯ "zh_CN"
    "admin": {
        "nickname": "Admin",
        ...
    }
}
```

---

### æµ‹è¯•3ï¼šé€‰æ‹©ä¸­æ–‡å¹¶åˆå§‹åŒ–

**æ­¥éª¤**ï¼š
1. åˆ é™¤ users.php é‡æ–°æµ‹è¯•
   ```bash
   rm -f bl-kernel/_maigewan/authz/users.php
   ```
2. è®¿é—® `/admin/system-init`
3. ç‚¹å‡»è¯­è¨€åˆ‡æ¢ï¼Œé€‰æ‹© "ä¸­æ–‡ç®€ä½“"
4. å¡«å†™ç®¡ç†å‘˜ä¿¡æ¯å¹¶æäº¤

**é¢„æœŸç»“æœ**ï¼š
```json
{
    "language": "zh_CN",   â† è¿™é‡Œåº”è¯¥æ˜¯ "zh_CN"
    "admin": {
        ...
    }
}
```

---

### æµ‹è¯•4ï¼šæ·»åŠ æ–°è¯­è¨€æ–‡ä»¶ï¼ˆæ‰©å±•æ€§æµ‹è¯•ï¼‰

**æ­¥éª¤**ï¼š
1. åœ¨ `bl-languages/` ç›®å½•æ·»åŠ æ–°è¯­è¨€æ–‡ä»¶ï¼ˆä¾‹å¦‚ `es.json`ï¼‰
2. æ–‡ä»¶å†…å®¹ç¤ºä¾‹ï¼š
   ```json
   {
       "language-data": {
           "native": "EspaÃ±ol",
           "english-name": "Spanish"
       }
   }
   ```
3. åˆ·æ–°åˆå§‹åŒ–é¡µé¢
4. ç‚¹å‡»è¯­è¨€åˆ‡æ¢æŒ‰é’®

**é¢„æœŸç»“æœ**ï¼š
- âœ… ä¸‹æ‹‰èœå•è‡ªåŠ¨æ˜¾ç¤º "EspaÃ±ol" é€‰é¡¹
- âœ… æ— éœ€ä¿®æ”¹ä»»ä½•ä»£ç 

---

### æµ‹è¯•5ï¼šç™»å½•åä¿®æ”¹è¯­è¨€

**æ­¥éª¤**ï¼š
1. ç™»å½•ç³»ç»Ÿ
2. è®¿é—® `/admin/settings`
3. åˆ‡æ¢åˆ° "Language" æ ‡ç­¾
4. ä¿®æ”¹è¯­è¨€è®¾ç½®å¹¶ä¿å­˜

**é¢„æœŸç»“æœ**ï¼š
- âœ… è¯­è¨€ä¿å­˜åˆ° `users.php` é¡¶å±‚
- âœ… è‡ªåŠ¨æ¸…ç† `sites/*/site.php` ä¸­çš„è¯­è¨€å­—æ®µ
- âœ… é¡µé¢åˆ·æ–°åæ˜¾ç¤ºæ–°è¯­è¨€

**éªŒè¯æ–¹å¼**ï¼š
```bash
# æ£€æŸ¥ users.php
cat bl-kernel/_maigewan/authz/users.php | grep "language"

# æ£€æŸ¥ site.phpï¼ˆåº”è¯¥æ²¡æœ‰ language å­—æ®µï¼‰
cat sites/1dun.co/site.php | grep "language"
# åº”è¯¥æ²¡æœ‰è¾“å‡º
```

---

### æµ‹è¯•6ï¼šLogout åŠŸèƒ½

**æ­¥éª¤**ï¼š
1. ç™»å½•ç³»ç»Ÿ
2. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ
3. ç‚¹å‡» "Logout"

**é¢„æœŸç»“æœ**ï¼š
- âœ… æˆåŠŸé€€å‡ºï¼Œæ²¡æœ‰ 500 é”™è¯¯
- âœ… é‡å®šå‘åˆ°ç™»å½•é¡µé¢

**éªŒè¯æ–¹å¼**ï¼š
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼Œåº”è¯¥æ²¡æœ‰é”™è¯¯
- è®¿é—® `/admin/dashboard`ï¼Œåº”è¯¥è¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢

---

## ğŸ” è°ƒè¯•æ–¹æ³•

### æŸ¥çœ‹è°ƒè¯•æ—¥å¿—

```bash
cat system-init-debug.log
```

### æŸ¥çœ‹ PHP é”™è¯¯æ—¥å¿—

```bash
tail -f /www/server/php/74/var/log/php-fpm.log
```

### æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—

```bash
tail -f /www/wwwlogs/maigewan-error.log
```

---

## âŒ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šè¯­è¨€è¿˜æ˜¯ä¿å­˜ä¸º zh_CN

**æ£€æŸ¥**ï¼š
```bash
# æŸ¥çœ‹è¡¨å•æ˜¯å¦åŒ…å« hidden field
grep -A5 "Hidden Language Field" bl-kernel/admin/views/system-init.php

# æŸ¥çœ‹æ§åˆ¶å™¨æ˜¯å¦æ£€æŸ¥ POST å‚æ•°
grep -A10 "isset(\$args\['language'\])" bl-kernel/admin/controllers/system-init.php
```

### é—®é¢˜2ï¼šè¯­è¨€åˆ—è¡¨ä¸ºç©º

**æ£€æŸ¥**ï¼š
```bash
# ç¡®è®¤è¯­è¨€æ–‡ä»¶å­˜åœ¨
ls -la bl-languages/*.json

# æ£€æŸ¥è¯­è¨€æ–‡ä»¶æ ¼å¼
cat bl-languages/en.json | grep "language-data"
```

### é—®é¢˜3ï¼šLogout 500 é”™è¯¯

**æ£€æŸ¥**ï¼š
```bash
# ç¡®è®¤ users.class.php åŒ…å« is_array() æ£€æŸ¥
grep -A3 "is_array(\$values)" bl-kernel/users.class.php
```

---

## ğŸ“Š æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```
æµ‹è¯•æ—¥æœŸï¼š____________________
æµ‹è¯•äººå‘˜ï¼š____________________

[ ] æµ‹è¯•1ï¼šè¯­è¨€åˆ—è¡¨åŠ¨æ€åŠ è½½ - é€šè¿‡/å¤±è´¥
[ ] æµ‹è¯•2ï¼šé€‰æ‹©è‹±æ–‡å¹¶åˆå§‹åŒ– - é€šè¿‡/å¤±è´¥
[ ] æµ‹è¯•3ï¼šé€‰æ‹©ä¸­æ–‡å¹¶åˆå§‹åŒ– - é€šè¿‡/å¤±è´¥
[ ] æµ‹è¯•4ï¼šæ·»åŠ æ–°è¯­è¨€æ–‡ä»¶ - é€šè¿‡/å¤±è´¥
[ ] æµ‹è¯•5ï¼šç™»å½•åä¿®æ”¹è¯­è¨€ - é€šè¿‡/å¤±è´¥
[ ] æµ‹è¯•6ï¼šLogout åŠŸèƒ½ - é€šè¿‡/å¤±è´¥

é—®é¢˜è®°å½•ï¼š
_______________________________________
_______________________________________
_______________________________________
```

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0
**æœ€åæ›´æ–°**ï¼š2025-11-02 14:35
